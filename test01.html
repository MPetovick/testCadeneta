<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMaster Pro - Gesti√≥n Predictiva de Stock</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #1a2530;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #95a5a6;
            --light-gray: #f5f7fa;
            --white: #ffffff;
            --sidebar-bg: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            --card-bg: #ffffff;
            --card-hover: rgba(255, 255, 255, 0.95);
            --text-dark: #333;
            --text-light: #fff;
            --text-gray: #7f8c8d;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .top-nav {
            background-color: var(--primary);
            color: var(--text-light);
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .logo-icon {
            font-size: 1.8rem;
            color: var(--secondary);
        }

        .logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-light);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .search-container {
            position: relative;
        }

        .search-container input {
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            transition: var(--transition);
            width: 250px;
        }

        .search-container input:focus {
            outline: none;
            background-color: rgba(255, 255, 255, 0.2);
            width: 300px;
        }

        .search-container i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .user-info i {
            font-size: 1.5rem;
        }

        .app-container {
            display: flex;
            min-height: calc(100vh - 60px);
        }

        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            color: var(--text-light);
            padding: 1.5rem 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: var(--shadow);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-menu li {
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .nav-menu li:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-menu li.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--secondary);
        }

        .nav-menu li i {
            width: 24px;
            text-align: center;
            font-size: 1.2rem;
        }

        .sidebar-footer {
            padding: 0 1.5rem;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success);
        }

        .status-indicator.active {
            background-color: var(--success);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .main-content {
            flex: 1;
            padding: 1.5rem;
            background-color: var(--light);
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
        }

        .date-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-weight: 500;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            gap: 1rem;
            transition: var(--transition);
            border-left: 4px solid var(--secondary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            background-color: var(--card-hover);
        }

        .stat-card.alerts {
            border-left: 4px solid var(--accent);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(52, 152, 219, 0.15);
            color: var(--secondary);
        }

        .stat-card.alerts .stat-icon {
            background: rgba(231, 76, 60, 0.15);
            color: var(--accent);
        }

        .stat-card.product-count .stat-icon {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .stat-card.rotation-rate .stat-icon {
            background: rgba(155, 89, 182, 0.15);
            color: #9b59b6;
        }

        .stat-info h3 {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .stat-info p {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: var(--text-dark);
        }

        .stat-trend {
            font-size: 0.85rem;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
            display: inline-block;
        }

        .positive {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .negative {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }

        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-header h3 {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
        }

        .chart-actions button {
            background: none;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--gray);
            transition: var(--transition);
        }

        .chart-actions button.active {
            background-color: var(--secondary);
            color: var(--white);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .critical-products {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .critical-product {
            padding: 1rem;
            border-radius: 6px;
            background-color: var(--light);
            transition: var(--transition);
        }

        .critical-product:hover {
            background-color: #e3f2fd;
        }

        .product-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .product-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .product-stock {
            color: var(--gray);
            font-weight: 500;
        }

        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
        }

        .critical { background-color: var(--danger); }
        .warning { background-color: var(--warning); }
        .ok { background-color: var(--success); }

        .replenish {
            font-size: 0.85rem;
            color: var(--danger);
            font-weight: 600;
        }

        .activity-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var--transition);
        }

        .activity-container:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .activity-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .activity-table th {
            text-align: left;
            padding: 0.8rem;
            background-color: var(--light);
            color: var(--gray);
            font-weight: 600;
            border-bottom: 1px solid #e0e0e0;
        }

        .activity-table td {
            padding: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .badge {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .sale { background-color: rgba(46, 204, 113, 0.15); color: var(--success); }
        .restock { background-color: rgba(52, 152, 219, 0.15); color: var(--secondary); }
        .order { background-color: rgba(155, 89, 182, 0.15); color: #9b59b6; }

        .status {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .completed { background-color: rgba(46, 204, 113, 0.15); color: var(--success); }
        .pending { background-color: rgba(243, 156, 18, 0.15); color: var(--warning); }

        .btn-primary {
            background-color: var(--secondary);
            color: var(--white);
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--white);
            color: var(--secondary);
            border: 1px solid var(--secondary);
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .btn-secondary:hover {
            background-color: rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }

        .inventory-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .inventory-controls .search-container input {
            width: 300px;
            background-color: var(--card-bg);
            color: var(--text-dark);
            border: 1px solid #ddd;
        }

        .inventory-controls .search-container input:focus {
            width: 300px;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .filter-btn.active {
            background-color: var(--secondary);
            color: var(--white);
            border-color: var(--secondary);
        }

        .inventory-table-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        .inventory-table-container:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
        }

        .inventory-table th {
            text-align: left;
            padding: 1rem;
            background-color: var(--light);
            color: var(--gray);
            font-weight: 600;
        }

        .inventory-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .inventory-table tr:last-child td {
            border-bottom: none;
        }

        .inventory-table tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status.critical {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }

        .status.warning {
            background-color: rgba(243, 156, 18, 0.15);
            color: var(--warning);
        }

        .status.low {
            background-color: rgba(52, 152, 219, 0.15);
            color: var(--secondary);
        }

        .status.ok {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .replenish {
            font-weight: 600;
            color: var(--secondary);
        }

        .action-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray);
        }

        .action-btn:hover {
            background-color: #f0f0f0;
            color: var(--secondary);
        }

        .action-btn.delete:hover {
            color: var(--danger);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .upload-area {
            border: 2px dashed var(--secondary);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            background-color: rgba(52, 152, 219, 0.05);
        }

        .upload-area:hover {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: var(--primary);
        }

        .upload-area i {
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .upload-area h3 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .upload-area p {
            color: var(--gray);
        }

        .dragover {
            background-color: rgba(46, 204, 113, 0.1) !important;
            border-color: var(--success) !important;
        }

        .processing {
            margin-top: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(52, 152, 219, 0.2);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            text-align: center;
        }

        .success-message i {
            color: var(--success);
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .prediction-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background-color: var(--light-gray);
            border-radius: 8px;
        }

        .prediction-controls label {
            font-weight: 500;
            color: var(--primary);
        }

        .prediction-controls input[type="range"] {
            width: 150px;
        }

        .prediction-value {
            font-weight: 600;
            color: var(--secondary);
        }

        .prediction-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--light-gray);
            border-radius: 8px;
        }

        .prediction-metric {
            padding: 1rem;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
            color: var(--primary);
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .confidence {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .high { background-color: rgba(46, 204, 113, 0.15); color: var(--success); }
        .medium { background-color: rgba(243, 156, 18, 0.15); color: var(--warning); }
        .low { background-color: rgba(231, 76, 60, 0.15); color: var(--danger); }

        .prediction-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .prediction-chart {
            height: 80px;
            width: 100%;
            position: relative;
            margin-top: 0.5rem;
        }

        .confidence-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .confidence-level {
            height: 100%;
        }

        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .nav-menu span {
                display: none;
            }
            
            .sidebar .sidebar-footer span {
                display: none;
            }
            
            .sidebar .logout-btn span {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .top-nav .nav-right {
                gap: 1rem;
            }
            
            .search-container input {
                width: 180px;
            }
            
            .search-container input:focus {
                width: 220px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .inventory-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .prediction-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Barra de navegaci√≥n superior -->
    <nav class="top-nav">
        <div class="nav-left">
            <i class="fas fa-store-alt logo-icon"></i>
            <h1 class="logo">StockMaster Pro</h1>
        </div>
        <div class="nav-right">
            <div class="search-container">
                <input type="text" placeholder="Buscar producto..." id="global-search">
                <i class="fas fa-search"></i>
            </div>
            <div class="user-info">
                <span>Estanc Gracia</span>
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </nav>

    <!-- Contenedor principal -->
    <div class="app-container">
        <!-- Barra lateral de navegaci√≥n -->
        <div class="sidebar">
            <ul class="nav-menu">
                <li class="active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </li>
                <li data-section="inventario">
                    <i class="fas fa-boxes"></i>
                    <span>Inventario</span>
                </li>
                <li data-section="movimientos">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Movimientos</span>
                </li>
                <li data-section="predicciones">
                    <i class="fas fa-chart-bar"></i>
                    <span>Predicciones</span>
                </li>
                <li data-section="pedidos">
                    <i class="fas fa-truck"></i>
                    <span>Pedidos</span>
                </li>
                <li data-section="config">
                    <i class="fas fa-cog"></i>
                    <span>Configuraci√≥n</span>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-indicator active"></div>
                    <span>Sistema en l√≠nea</span>
                </div>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar sesi√≥n</span>
                </button>
            </div>
        </div>

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- Dashboard -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>Panel de Control</h2>
                    <div class="date-display">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="current-date"></span>
                    </div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card total-value">
                        <div class="stat-icon">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Valor Total</h3>
                            <p id="total-value">‚Ç¨4,850.60</p>
                            <span class="stat-trend positive">+2.5%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card product-count">
                        <div class="stat-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Productos</h3>
                            <p id="product-count">42</p>
                            <span class="stat-trend negative">3 a reponer</span>
                        </div>
                    </div>
                    
                    <div class="stat-card rotation-rate">
                        <div class="stat-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Rotaci√≥n</h3>
                            <p id="rotation-rate">1.8</p>
                            <span class="stat-trend positive">+0.3</span>
                        </div>
                    </div>
                    
                    <div class="stat-card alerts">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Alertas</h3>
                            <p id="alert-count">5</p>
                            <span class="stat-trend negative">Requieren atenci√≥n</span>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Demanda Mensual</h3>
                            <div class="chart-actions">
                                <button data-period="month">Mensual</button>
                                <button class="active" data-period="quarter">Trimestral</button>
                                <button data-period="year">Anual</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="demand-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Productos Cr√≠ticos</h3>
                        </div>
                        <div class="critical-products" id="critical-products">
                            <!-- Los productos cr√≠ticos se cargar√°n din√°micamente -->
                        </div>
                    </div>
                </div>
                
                <div class="activity-container">
                    <div class="section-header">
                        <h3>Actividad Reciente</h3>
                        <button class="btn-primary" id="view-all-activity">Ver todo</button>
                    </div>
                    
                    <table class="activity-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="recent-activity">
                            <!-- La actividad se cargar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Inventario -->
            <section id="inventario" class="content-section">
                <div class="section-header">
                    <h2>Gesti√≥n de Inventario</h2>
                    <div>
                        <button class="btn-primary" id="add-product">
                            <i class="fas fa-plus-circle"></i> Nuevo Producto
                        </button>
                        <button class="btn-secondary" id="import-pdf">
                            <i class="fas fa-file-pdf"></i> Importar PDF
                        </button>
                        <button class="btn-secondary" id="export-data">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                </div>
                
                <!-- √Årea para arrastrar y soltar PDF -->
                <div class="upload-area" id="pdf-drop-zone">
                    <i class="fas fa-file-pdf fa-3x"></i>
                    <h3>Arrastra tu PDF de LKBitronics aqu√≠</h3>
                    <p>o haz clic para seleccionar archivo</p>
                    <input type="file" id="pdf-upload" accept=".pdf" style="display: none;">
                    <div class="processing" id="processing" style="display: none;">
                        <div class="spinner"></div>
                        <p>Procesando PDF...</p>
                    </div>
                </div>
                
                <div class="inventory-controls">
                    <div class="search-container">
                        <input type="text" placeholder="Buscar producto..." id="search-product">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="filters">
                        <button class="filter-btn active" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="critical">Cr√≠ticos</button>
                        <button class="filter-btn" data-filter="warning">Advertencia</button>
                        <button class="filter-btn" data-filter="ok">OK</button>
                    </div>
                </div>
                
                <div class="inventory-table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Stock Actual</th>
                                <th>Stock M√≠n</th>
                                <th>Stock M√°x</th>
                                <th>Estado</th>
                                <th>Reposici√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-body">
                            <!-- Los datos se cargar√°n din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Movimientos -->
            <section id="movimientos" class="content-section">
                <div class="section-header">
                    <h2>Registro de Movimientos</h2>
                </div>
                <div class="upload-area">
                    <i class="fas fa-exchange-alt fa-3x"></i>
                    <h3>Importar movimientos desde LKBitronics</h3>
                    <p>Pr√≥ximamente en la versi√≥n 2.0</p>
                </div>
            </section>
            
            <!-- Predicciones -->
            <section id="predicciones" class="content-section">
                <div class="section-header">
                    <h2>Predicciones de Stock Avanzadas</h2>
                    <div class="prediction-controls">
                        <label>
                            Horizonte: 
                            <select id="horizon">
                                <option value="1">1 mes</option>
                                <option value="2">2 meses</option>
                                <option value="3" selected>3 meses</option>
                            </select>
                        </label>
                        <button class="btn-primary" id="apply-forecast">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>An√°lisis Predictivo Holt-Winters</h3>
                        <span class="confidence high">Precisi√≥n: 92%</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="prediction-chart"></canvas>
                    </div>
                </div>
                
                <div class="prediction-info">
                    <div class="prediction-metric">
                        <div class="metric-label">Tasa de Rotaci√≥n</div>
                        <div class="metric-value">1.85</div>
                        <div class="metric-label">Impacto en predicci√≥n</div>
                        <div class="confidence high">Alta rotaci√≥n</div>
                    </div>
                    
                    <div class="prediction-metric">
                        <div class="metric-label">Estacionalidad</div>
                        <div class="metric-value">+15%</div>
                        <div class="metric-label">Pr√≥ximo mes</div>
                        <div class="confidence medium">Estacionalidad media</div>
                    </div>
                    
                    <div class="prediction-metric">
                        <div class="metric-label">Error promedio</div>
                        <div class="metric-value">¬±6.2%</div>
                        <div class="metric-label">Confianza</div>
                        <div class="confidence high">Alta confianza</div>
                    </div>
                </div>
                
                <div class="section-header">
                    <h3>Recomendaciones de Stock</h3>
                </div>
                
                <div class="prediction-card">
                    <div class="prediction-header">
                        <div class="product-name">Marlboro Rojo</div>
                        <div class="confidence medium">Precisi√≥n 85%</div>
                    </div>
                    <p>Stock actual: 45 unidades</p>
                    <div class="prediction-chart">
                        <canvas id="product-chart-1"></canvas>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-level" style="width: 85%; background-color: #f39c12;"></div>
                    </div>
                    <p class="replenish">Recomendaci√≥n: Pedir 65 unidades para el pr√≥ximo mes</p>
                </div>
                
                <div class="prediction-card">
                    <div class="prediction-header">
                        <div class="product-name">Loter√≠a Nacional</div>
                        <div class="confidence high">Precisi√≥n 92%</div>
                    </div>
                    <p>Stock actual: 85 unidades</p>
                    <div class="prediction-chart">
                        <canvas id="product-chart-2"></canvas>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-level" style="width: 92%; background-color: #2ecc71;"></div>
                    </div>
                    <p class="replenish">Recomendaci√≥n: Mantener stock actual</p>
                </div>
            </section>
            
            <!-- Pedidos -->
            <section id="pedidos" class="content-section">
                <div class="section-header">
                    <h2>Gesti√≥n de Pedidos</h2>
                    <button class="btn-primary">
                        <i class="fas fa-plus-circle"></i> Nuevo Pedido
                    </button>
                </div>
                <div class="upload-area">
                    <i class="fas fa-truck fa-3x"></i>
                    <h3>Recomendaciones de Pedido</h3>
                    <p>Basado en el an√°lisis de stock actual</p>
                </div>
            </section>
            
            <!-- Configuraci√≥n -->
            <section id="config" class="content-section">
                <div class="section-header">
                    <h2>Configuraci√≥n del Sistema</h2>
                </div>
                <div class="chart-card">
                    <h3>Integraci√≥n con LKBitronics</h3>
                    <div class="form-group">
                        <label>Frecuencia de sincronizaci√≥n</label>
                        <select>
                            <option>Diaria</option>
                            <option>Semanal</option>
                            <option>Mensual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Niveles de alerta predeterminados</label>
                        <input type="number" placeholder="Stock m√≠nimo" value="20">
                        <p class="help-text">Se aplicar√° a nuevos productos</p>
                    </div>
                    <button class="btn-primary">Guardar Configuraci√≥n</button>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Modal para nuevo producto -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">A√±adir Nuevo Producto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    <div class="form-group">
                        <label for="product-name">Nombre del Producto</label>
                        <input type="text" id="product-name" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="current-stock">Stock Actual</label>
                            <input type="number" id="current-stock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="min-stock">Stock M√≠nimo</label>
                            <input type="number" id="min-stock" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="max-stock">Stock M√°ximo</label>
                            <input type="number" id="max-stock" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">Categor√≠a</label>
                        <select id="category">
                            <option value="tabaco">Tabaco</option>
                            <option value="loter√≠a">Loter√≠a</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="supplier">Proveedor</label>
                        <input type="text" id="supplier">
                    </div>
                    
                    <div class="form-actions">
                        <button type="reset" class="btn-secondary" id="cancel-btn">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar Producto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Estado de la aplicaci√≥n
        const state = {
            currentSection: 'dashboard',
            inventory: [],
            activities: [],
            stats: {
                totalValue: 0,
                productCount: 0,
                rotationRate: 0,
                alertCount: 0
            },
            charts: {
                demand: null,
                prediction: null
            },
            predictionSettings: {
                horizon: 3
            },
            historicalSales: [120, 150, 180, 140, 200, 170, 190, 210, 180, 200, 220, 250],
            forecastModel: null,
            forecast: [],
            forecastConfidence: []
        };

        // Modelo Holt-Winters para predicciones
        class HoltWinters {
            constructor(alpha = 0.2, beta = 0.1, gamma = 0.1, seasonality = 12) {
                this.alpha = alpha;
                this.beta = beta;
                this.gamma = gamma;
                this.seasonality = seasonality;
                this.level = 0;
                this.trend = 0;
                this.seasons = [];
            }

            initialize(series) {
                if (series.length < this.seasonality) {
                    throw new Error("Se requieren al menos un a√±o de datos");
                }

                this.level = series[0];
                this.trend = (series[this.seasonality] - series[0]) / this.seasonality;
                
                this.seasons = Array(this.seasonality).fill(0);
                for (let i = 0; i < this.seasonality; i++) {
                    this.seasons[i] = series[i] - this.level;
                }
            }

            forecast(steps) {
                const predictions = [];
                let level = this.level;
                let trend = this.trend;
                const seasons = [...this.seasons];

                for (let i = 0; i < steps; i++) {
                    const step = i + 1;
                    const seasonIndex = (this.seasons.length - this.seasonality + step) % this.seasonality;
                    const prediction = level + step * trend + seasons[seasonIndex];
                    predictions.push(Math.max(0, Math.round(prediction)));
                }

                return predictions;
            }

            update(observation) {
                const prevLevel = this.level;
                const prevTrend = this.trend;
                const prevSeason = this.seasons.shift();

                this.level = this.alpha * (observation - prevSeason) + (1 - this.alpha) * (prevLevel + prevTrend);
                this.trend = this.beta * (this.level - prevLevel) + (1 - this.beta) * prevTrend;
                const newSeason = this.gamma * (observation - this.level) + (1 - this.gamma) * prevSeason;
                this.seasons.push(newSeason);
            }
        }

        // Claves para localStorage
        const STORAGE_KEYS = {
            INVENTORY: 'stockmaster_inventory',
            ACTIVITIES: 'stockmaster_activities',
            SETTINGS: 'stockmaster_settings',
            HISTORICAL_SALES: 'stockmaster_historical_sales'
        };

        // Inicializaci√≥n de la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        function initApp() {
            // Cargar datos guardados
            loadSavedState();
            
            // Configuraci√≥n inicial
            setCurrentDate();
            setupNavigation();
            setupEventListeners();
            
            // Inicializar modelo de predicci√≥n
            initForecastModel();
            
            // Mostrar la secci√≥n activa
            showSection('dashboard');
        }

        function initForecastModel() {
            if (state.historicalSales.length < 12) {
                console.warn("No hay suficientes datos para inicializar el modelo de predicci√≥n (se requieren 12 meses)");
                return;
            }

            try {
                state.forecastModel = new HoltWinters(0.2, 0.1, 0.1, 12);
                state.forecastModel.initialize(state.historicalSales);
                updateForecast();
            } catch (e) {
                console.error("Error al inicializar el modelo de predicci√≥n:", e);
            }
        }

        function updateForecast() {
            if (!state.forecastModel) return;

            state.forecast = state.forecastModel.forecast(state.predictionSettings.horizon);
            // C√°lculo de intervalo de confianza (10-15%)
            state.forecastConfidence = state.forecast.map(value => [
                Math.max(0, Math.round(value * 0.85)),
                Math.round(value * 1.15)
            ]);
        }

        // Cargar datos guardados desde localStorage
        function loadSavedState() {
            // Cargar inventario
            const savedInventory = localStorage.getItem(STORAGE_KEYS.INVENTORY);
            state.inventory = savedInventory ? JSON.parse(savedInventory) : getDefaultInventory();
            
            // Cargar actividades
            const savedActivities = localStorage.getItem(STORAGE_KEYS.ACTIVITIES);
            state.activities = savedActivities ? JSON.parse(savedActivities) : getDefaultActivities();
            
            // Cargar configuraci√≥n
            const savedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
            if (savedSettings) {
                state.predictionSettings = JSON.parse(savedSettings);
                document.getElementById('horizon').value = state.predictionSettings.horizon;
            }
            
            // Cargar ventas hist√≥ricas
            const savedHistorical = localStorage.getItem(STORAGE_KEYS.HISTORICAL_SALES);
            state.historicalSales = savedHistorical ? JSON.parse(savedHistorical) : state.historicalSales;
            
            // Calcular estad√≠sticas
            calculateStats();
        }

        // Guardar estado en localStorage
        function saveState() {
            localStorage.setItem(STORAGE_KEYS.INVENTORY, JSON.stringify(state.inventory));
            localStorage.setItem(STORAGE_KEYS.ACTIVITIES, JSON.stringify(state.activities));
            localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(state.predictionSettings));
            localStorage.setItem(STORAGE_KEYS.HISTORICAL_SALES, JSON.stringify(state.historicalSales));
        }

        // Inventario por defecto
        function getDefaultInventory() {
            return [
                { id: 1, name: 'Marlboro Rojo', stock: 15, min: 20, max: 100, status: 'critical', replenish: 35, category: 'tabaco', supplier: 'Tabacalera S.A.' },
                { id: 2, name: 'Fortuna Azul', stock: 45, min: 30, max: 120, status: 'low', replenish: 15, category: 'tabaco', supplier: 'Tabacalera S.A.' },
                { id: 3, name: 'Loter√≠a Nacional', stock: 85, min: 50, max: 200, status: 'ok', replenish: 0, category: 'loter√≠a', supplier: 'Loter√≠as del Estado' },
                { id: 4, name: 'Caf√© Cortado', stock: 8, min: 10, max: 50, status: 'critical', replenish: 22, category: 'bebidas', supplier: 'Nescaf√©' },
                { id: 5, name: 'Chicles Orbit', stock: 35, min: 20, max: 80, status: 'ok', replenish: 0, category: 'snacks', supplier: 'Wrigley' },
                { id: 6, name: 'Fortuna Rojo', stock: 25, min: 25, max: 100, status: 'warning', replenish: 15, category: 'tabaco', supplier: 'Tabacalera S.A.' },
                { id: 7, name: 'Tabaco de liar', stock: 12, min: 15, max: 60, status: 'critical', replenish: 28, category: 'tabaco', supplier: 'Golden Virginia' },
                { id: 8, name: 'Billetes de loter√≠a', stock: 95, min: 50, max: 200, status: 'ok', replenish: 0, category: 'loter√≠a', supplier: 'Loter√≠as del Estado' }
            ];
        }

        // Actividades por defecto
        function getDefaultActivities() {
            return [
                { product: 'Marlboro Rojo', type: 'Venta', quantity: 5, date: '15/06/2025', status: 'Completado' },
                { product: 'Loter√≠a Nacional', type: 'Recarga', quantity: 100, date: '14/06/2025', status: 'Completado' },
                { product: 'Caf√© Cortado', type: 'Venta', quantity: 12, date: '14/06/2025', status: 'Completado' },
                { product: 'Fortuna Rojo', type: 'Pedido', quantity: 50, date: '13/06/2025', status: 'En camino' }
            ];
        }

        // Calcular estad√≠sticas
        function calculateStats() {
            state.stats = {
                totalValue: state.inventory.reduce((sum, product) => sum + (product.stock * 5.5), 0),
                productCount: state.inventory.length,
                rotationRate: calculateInventoryTurnover(),
                alertCount: state.inventory.filter(p => p.status === 'critical' || p.status === 'warning').length
            };
            
            // Actualizar estad√≠sticas en el dashboard
            document.getElementById('total-value').textContent = `‚Ç¨${state.stats.totalValue.toFixed(2)}`;
            document.getElementById('product-count').textContent = state.stats.productCount;
            document.getElementById('rotation-rate').textContent = state.stats.rotationRate;
            document.getElementById('alert-count').textContent = state.stats.alertCount;
        }

        // Calcular rotaci√≥n de inventario (simplificado)
        function calculateInventoryTurnover() {
            const totalSales = state.activities
                .filter(a => a.type === 'Venta')
                .reduce((sum, sale) => sum + sale.quantity, 0);
            
            const avgInventory = state.inventory.reduce((sum, product) => sum + product.stock, 0) / state.inventory.length;
            
            return avgInventory > 0 ? (totalSales / avgInventory).toFixed(2) : 0;
        }

        // Configurar la fecha actual
        function setCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = 
                now.toLocaleDateString('es-ES', options);
        }

        // Configurar navegaci√≥n
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-menu li');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const sectionId = item.getAttribute('data-section');
                    showSection(sectionId);
                });
            });
            
            // Bot√≥n de cierre de sesi√≥n
            document.getElementById('logout-btn').addEventListener('click', () => {
                if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                    // Aqu√≠ ir√≠a la l√≥gica de logout
                    alert('Sesi√≥n cerrada');
                }
            });
        }

        // Mostrar secci√≥n
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Desactivar todos los elementos de navegaci√≥n
            document.querySelectorAll('.nav-menu li').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
            }
            
            // Activar elemento de navegaci√≥n correspondiente
            const navItem = document.querySelector(`.nav-menu li[data-section="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Actualizar contenido si es necesario
            if (sectionId === 'dashboard') {
                renderDashboard();
            } else if (sectionId === 'inventario') {
                renderInventory();
            } else if (sectionId === 'predicciones') {
                renderPredictionChart();
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Botones de filtro de inventario
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    const filter = button.getAttribute('data-filter');
                    renderInventory(filter);
                });
            });
            
            // Bot√≥n para a√±adir producto
            document.getElementById('add-product').addEventListener('click', () => {
                openProductModal();
            });
            
            // Cerrar modal
            document.querySelector('.close-modal').addEventListener('click', closeProductModal);
            document.getElementById('cancel-btn')?.addEventListener('click', closeProductModal);
            
            // Formulario de producto
            document.getElementById('product-form').addEventListener('submit', (e) => {
                e.preventDefault();
                saveProduct();
            });
            
            // B√∫squeda en inventario
            const searchInput = document.getElementById('search-product');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    filterInventory(e.target.value);
                });
            }
            
            // Ver toda la actividad
            const viewAllBtn = document.getElementById('view-all-activity');
            if (viewAllBtn) {
                viewAllBtn.addEventListener('click', () => {
                    showSection('movimientos');
                });
            }
            
            // Botones de periodo en gr√°fico
            const chartButtons = document.querySelectorAll('.chart-actions button');
            if (chartButtons.length > 0) {
                chartButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.chart-actions button').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        button.classList.add('active');
                        renderDemandChart(button.getAttribute('data-period'));
                    });
                });
            }
            
            // Control de horizonte para predicciones
            const horizonSelect = document.getElementById('horizon');
            if (horizonSelect) {
                horizonSelect.addEventListener('change', (e) => {
                    state.predictionSettings.horizon = parseInt(e.target.value);
                    saveState();
                    updateForecast();
                    renderPredictionChart();
                });
            }
            
            // Bot√≥n para actualizar predicciones
            const applyBtn = document.getElementById('apply-forecast');
            if (applyBtn) {
                applyBtn.addEventListener('click', () => {
                    renderPredictionChart();
                });
            }

            // Actualizar modelo con nuevos datos de ventas
            document.addEventListener('new-sale', (e) => {
                if (state.forecastModel) {
                    state.forecastModel.update(e.detail.sales);
                    state.historicalSales.push(e.detail.sales);
                    saveState();
                    updateForecast();
                    
                    if (state.currentSection === 'predicciones') {
                        renderPredictionChart();
                    }
                }
            });
            
            // Configurar arrastrar y soltar PDF
            setupPDFHandlers();
        }

        // Simulaci√≥n de nueva venta (para demostraci√≥n)
        function simulateNewSale() {
            const sales = Math.round(180 + Math.random() * 40);
            document.dispatchEvent(new CustomEvent('new-sale', {
                detail: { sales: sales }
            }));
        }

        // Renderizar dashboard
        function renderDashboard() {
            // Actualizar estad√≠sticas
            document.getElementById('total-value').textContent = `‚Ç¨${state.stats.totalValue.toFixed(2)}`;
            document.getElementById('product-count').textContent = state.stats.productCount;
            document.getElementById('rotation-rate').textContent = state.stats.rotationRate;
            document.getElementById('alert-count').textContent = state.stats.alertCount;
            
            // Renderizar productos cr√≠ticos
            renderCriticalProducts();
            
            // Renderizar actividad reciente
            renderRecentActivity();
            
            // Renderizar gr√°fico de demanda
            renderDemandChart('quarter');
        }

        // Renderizar productos cr√≠ticos
        function renderCriticalProducts() {
            const container = document.getElementById('critical-products');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Obtener productos cr√≠ticos (status: critical o warning)
            const criticalProducts = state.inventory.filter(p => 
                p.status === 'critical' || p.status === 'warning'
            ).slice(0, 3); // Mostrar solo 3
            
            criticalProducts.forEach(product => {
                const percentage = Math.min(100, (product.stock / product.min) * 100);
                
                const productEl = document.createElement('div');
                productEl.className = 'critical-product';
                productEl.innerHTML = `
                    <div class="product-info">
                        <span class="product-name">${product.name}</span>
                        <span class="product-stock">${product.stock}/${product.min}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${product.status}" 
                             style="width: ${percentage}%"></div>
                    </div>
                    <span class="replenish">Reponer: ${product.replenish} uds</span>
                `;
                
                container.appendChild(productEl);
            });
        }

        // Renderizar actividad reciente
        function renderRecentActivity() {
            const tbody = document.getElementById('recent-activity');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            state.activities.forEach(activity => {
                const row = document.createElement('tr');
                
                // Determinar clase de estado y tipo
                const statusClass = activity.status === 'Completado' ? 'completed' : 'pending';
                const badgeClass = activity.type === 'Venta' ? 'sale' : 
                                activity.type === 'Recarga' ? 'restock' : 'order';
                
                row.innerHTML = `
                    <td>${activity.product}</td>
                    <td><span class="badge ${badgeClass}">${activity.type}</span></td>
                    <td>${activity.quantity}</td>
                    <td>${activity.date}</td>
                    <td><span class="status ${statusClass}">${activity.status}</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Renderizar gr√°fico de demanda
        function renderDemandChart(period = 'quarter') {
            const canvas = document.getElementById('demand-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Datos basados en el periodo seleccionado
            let labels, realData, predictionData;
            
            switch(period) {
                case 'month':
                    labels = ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'];
                    realData = [45, 52, 60, 48];
                    predictionData = [null, null, null, 50];
                    break;
                case 'quarter':
                    labels = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul'];
                    realData = [120, 150, 180, 140, 200, 170, 190];
                    predictionData = [null, null, null, null, null, 170, 185];
                    break;
                case 'year':
                    labels = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
                    realData = [120, 150, 180, 140, 200, 170, 190, 210, 180, 200, 220, 250];
                    predictionData = [null, null, null, null, null, null, null, null, null, null, 230, 260];
                    break;
            }
            
            const data = {
                labels: labels,
                datasets: [{
                    label: 'Ventas Reales',
                    data: realData,
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }, {
                    label: 'Predicci√≥n',
                    data: predictionData,
                    borderColor: 'rgba(231, 76, 60, 1)',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    tension: 0.3,
                    fill: false
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Unidades Vendidas'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: period === 'month' ? 'Semanas' : 'Meses'
                        }
                    }
                }
            };
            
            // Destruir gr√°fico existente si hay uno
            if (state.charts.demand) {
                state.charts.demand.destroy();
            }
            
            // Crear nuevo gr√°fico
            state.charts.demand = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
            });
        }

        // Renderizar inventario
        function renderInventory(filter = 'all') {
            const tbody = document.getElementById('inventory-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Filtrar productos
            let products = [...state.inventory];
            
            if (filter !== 'all') {
                products = products.filter(product => product.status === filter);
            }
            
            // Ordenar por estado cr√≠tico primero
            products.sort((a, b) => {
                const statusOrder = { critical: 1, warning: 2, low: 3, ok: 4 };
                return statusOrder[a.status] - statusOrder[b.status];
            });
            
            // Renderizar productos
            products.forEach(product => {
                const row = document.createElement('tr');
                row.dataset.id = product.id;
                
                // Determinar clase de estado
                let statusClass = '';
                let statusText = '';
                switch (product.status) {
                    case 'critical':
                        statusClass = 'critical';
                        statusText = 'REPONER';
                        break;
                    case 'warning':
                        statusClass = 'warning';
                        statusText = 'ADVERTENCIA';
                        break;
                    case 'low':
                        statusClass = 'low';
                        statusText = 'BAJO';
                        break;
                    case 'ok':
                        statusClass = 'ok';
                        statusText = 'OK';
                        break;
                }
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.stock}</td>
                    <td>${product.min}</td>
                    <td>${product.max}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>${product.replenish > 0 ? `<span class="replenish">${product.replenish} uds</span>` : '-'}</td>
                    <td>
                        <button class="action-btn edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de acci√≥n
            document.querySelectorAll('.action-btn.edit').forEach(button => {
                button.addEventListener('click', (e) => {
                    const row = e.target.closest('tr');
                    const productId = parseInt(row.dataset.id);
                    const product = state.inventory.find(p => p.id === productId);
                    openProductModal(product);
                });
            });
            
            document.querySelectorAll('.action-btn.delete').forEach(button => {
                button.addEventListener('click', (e) => {
                    const row = e.target.closest('tr');
                    const productId = parseInt(row.dataset.id);
                    const product = state.inventory.find(p => p.id === productId);
                    
                    if (confirm(`¬øEst√° seguro de eliminar "${product.name}"?`)) {
                        // Eliminar del estado
                        state.inventory = state.inventory.filter(p => p.id !== productId);
                        
                        // Actualizar estad√≠sticas
                        calculateStats();
                        
                        // Guardar estado
                        saveState();
                        
                        // Actualizar UI
                        renderInventory();
                        renderDashboard();
                        
                        // Mostrar notificaci√≥n
                        showNotification(`Producto "${product.name}" eliminado`, 'success');
                    }
                });
            });
        }

        // Filtrar inventario por b√∫squeda
        function filterInventory(searchTerm) {
            const tbody = document.getElementById('inventory-body');
            if (!tbody) return;
            
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const productName = row.cells[0].textContent.toLowerCase();
                if (productName.includes(searchTerm.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Abrir modal de producto
        function openProductModal(product = null) {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('modal-title');
            const form = document.getElementById('product-form');
            
            if (product) {
                // Modo edici√≥n
                title.textContent = 'Editar Producto';
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('current-stock').value = product.stock;
                document.getElementById('min-stock').value = product.min;
                document.getElementById('max-stock').value = product.max;
                document.getElementById('category').value = product.category;
                document.getElementById('supplier').value = product.supplier || '';
            } else {
                // Modo nuevo
                title.textContent = 'A√±adir Nuevo Producto';
                form.reset();
                document.getElementById('product-id').value = '';
            }
            
            modal.classList.add('active');
        }

        // Cerrar modal de producto
        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
        }

        // Guardar producto (nuevo o edici√≥n)
        function saveProduct() {
            const idInput = document.getElementById('product-id');
            const name = document.getElementById('product-name').value;
            const stock = parseInt(document.getElementById('current-stock').value);
            const min = parseInt(document.getElementById('min-stock').value);
            const max = parseInt(document.getElementById('max-stock').value);
            const category = document.getElementById('category').value;
            const supplier = document.getElementById('supplier').value;
            
            // Validar datos
            if (!name || isNaN(stock) || isNaN(min) || isNaN(max) || max <= min) {
                alert('Por favor complete todos los campos requeridos correctamente');
                return;
            }
            
            // Determinar estado y cantidad a reponer
            let status = 'ok';
            let replenish = 0;
            
            if (stock < min) {
                status = 'critical';
                replenish = min - stock + 10; // Reponer stock m√≠nimo + 10 unidades
            } else if (stock < min + 5) {
                status = 'warning';
                replenish = min + 5 - stock;
            } else if (stock < min + 10) {
                status = 'low';
                replenish = min + 10 - stock;
            }
            
            // Crear o actualizar producto
            if (idInput.value) {
                // Modo edici√≥n
                const id = parseInt(idInput.value);
                const index = state.inventory.findIndex(p => p.id === id);
                
                if (index !== -1) {
                    state.inventory[index] = {
                        ...state.inventory[index],
                        name,
                        stock,
                        min,
                        max,
                        status,
                        replenish,
                        category,
                        supplier
                    };
                    
                    showNotification(`Producto "${name}" actualizado`, 'success');
                }
            } else {
                // Nuevo producto
                const newProduct = {
                    id: state.inventory.length > 0 ? Math.max(...state.inventory.map(p => p.id)) + 1 : 1,
                    name,
                    stock,
                    min,
                    max,
                    status,
                    replenish,
                    category,
                    supplier
                };
                
                state.inventory.push(newProduct);
                showNotification(`Producto "${name}" a√±adido`, 'success');
            }
            
            // Actualizar estad√≠sticas
            calculateStats();
            
            // Guardar estado
            saveState();
            
            // Actualizar UI
            renderInventory();
            renderDashboard();
            
            // Cerrar modal
            closeProductModal();
        }

        // Configurar manejadores de PDF
        function setupPDFHandlers() {
            const dropZone = document.getElementById('pdf-drop-zone');
            const fileInput = document.getElementById('pdf-upload');
            
            if (!dropZone || !fileInput) return;
            
            // Click en el √°rea de carga
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Cambio en el input de archivo
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processPDF(e.target.files[0]);
                }
            });
            
            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    if (file.type === 'application/pdf') {
                        processPDF(file);
                    } else {
                        showNotification('Por favor, sube un archivo PDF', 'error');
                    }
                }
            });
            
            // Bot√≥n de exportaci√≥n
            document.getElementById('export-data')?.addEventListener('click', exportInventory);
        }

        // Procesar el PDF (simulaci√≥n)
        function processPDF(file) {
            const dropZone = document.getElementById('pdf-drop-zone');
            const processing = document.getElementById('processing');
            
            if (!dropZone || !processing) return;
            
            // Mostrar estado de procesamiento
            dropZone.innerHTML = '';
            dropZone.appendChild(processing);
            processing.style.display = 'flex';
            
            // Simular procesamiento
            setTimeout(() => {
                // Generar datos simulados
                const simulatedData = generateInventoryFromPDF(file.name);
                
                // Actualizar el inventario
                state.inventory = [...state.inventory, ...simulatedData];
                
                // Actualizar estad√≠sticas
                calculateStats();
                
                // Guardar estado
                saveState();
                
                // Renderizar inventario
                renderInventory();
                renderDashboard();
                
                // Mostrar mensaje de √©xito
                processing.style.display = 'none';
                dropZone.innerHTML = `
                    <div class="success-message">
                        <i class="fas fa-check-circle fa-3x"></i>
                        <h3>¬°PDF procesado correctamente!</h3>
                        <p>Se importaron ${simulatedData.length} productos</p>
                    </div>
                `;
                
                // Restaurar despu√©s de 5 segundos
                setTimeout(() => {
                    dropZone.innerHTML = `
                        <i class="fas fa-file-pdf fa-3x"></i>
                        <h3>Arrastra tu PDF de LKBitronics aqu√≠</h3>
                        <p>o haz clic para seleccionar archivo</p>
                    `;
                    setupPDFHandlers(); // Reconfigurar handlers
                }, 5000);
                
            }, 3000);
        }

        // Simulaci√≥n de extracci√≥n de datos de PDF
        function generateInventoryFromPDF(filename) {
            const date = new Date().toLocaleDateString('es-ES');
            const products = [];
            
            // Simular diferentes tipos de PDF
            if (filename.includes("diario")) {
                for (let i = 1; i <= 8; i++) {
                    products.push(createSimulatedProduct(`Producto Diario ${i}`, date));
                }
            } else if (filename.includes("tabaco")) {
                const tobaccoBrands = [
                    "Marlboro Rojo", "Fortuna Azul", "Camel Azul", 
                    "Winston XS", "Chesterfield Blue", "LM Rojo"
                ];
                
                tobaccoBrands.forEach(brand => {
                    products.push(createSimulatedProduct(brand, date, 'tabaco'));
                });
            } else {
                for (let i = 1; i <= 12; i++) {
                    products.push(createSimulatedProduct(`Producto ${i} de ${filename.split('.')[0]}`, date));
                }
            }
            
            return products;
        }

        // Crear producto simulado
        function createSimulatedProduct(name, date, category = "general") {
            const stock = Math.floor(Math.random() * 100) + 20;
            const min = Math.floor(Math.random() * 30) + 10;
            const max = min + Math.floor(Math.random() * 70) + 50;
            
            let status = 'ok';
            let replenish = 0;
            
            if (stock < min) {
                status = 'critical';
                replenish = min - stock + 10;
            } else if (stock < min + 5) {
                status = 'warning';
                replenish = min + 5 - stock;
            } else if (stock < min + 10) {
                status = 'low';
                replenish = min + 10 - stock;
            }
            
            return {
                id: state.inventory.length > 0 ? Math.max(...state.inventory.map(p => p.id)) + 1 : 1,
                name,
                stock,
                min,
                max,
                status,
                replenish,
                category,
                lastUpdate: date
            };
        }

        // Funci√≥n de exportaci√≥n
        function exportInventory() {
            const dataStr = "data:text/json;charset=utf-8," + 
                encodeURIComponent(JSON.stringify(state.inventory, null, 2));
            
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "inventario-estanco.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            downloadAnchor.remove();
            
            showNotification('Inventario exportado correctamente', 'success');
        }

        function renderPredictionChart() {
            const canvas = document.getElementById('prediction-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Datos hist√≥ricos
            const historicalData = state.historicalSales;
            const forecastData = state.forecast;
            const confidence = state.forecastConfidence;
            
            // Generar etiquetas
            const labels = [
                ...historicalData.map((_, i) => `M${i+1}`),
                ...forecastData.map((_, i) => `P${i+1}`)
            ];
            
            const data = {
                labels: labels,
                datasets: [
                    {
                        label: 'Ventas Reales',
                        data: [...historicalData, ...Array(forecastData.length).fill(null)],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Predicci√≥n',
                        data: [...Array(historicalData.length).fill(null), ...forecastData],
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Intervalo de Confianza (85%)',
                        data: [...Array(historicalData.length).fill(null), ...confidence.map(c => c[1])],
                        borderColor: 'rgba(231, 76, 60, 0.2)',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: '-1',
                        tension: 0.3
                    },
                    {
                        label: '',
                        data: [...Array(historicalData.length).fill(null), ...confidence.map(c => c[0])],
                        borderColor: 'rgba(231, 76, 60, 0.2)',
                        borderWidth: 1,
                        pointRadius: 0,
                        tension: 0.3,
                        fill: false
                    }
                ]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' unidades';
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Unidades Vendidas'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Meses (M) y Predicciones (P)'
                        }
                    }
                }
            };
            
            // Destruir gr√°fico existente si hay uno
            if (state.charts.prediction) {
                state.charts.prediction.destroy();
            }
            
            // Crear nuevo gr√°fico
            state.charts.prediction = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
            });
            
            // Actualizar informaci√≥n de rotaci√≥n
            document.getElementById('current-rotation').textContent = state.stats.rotationRate;
            document.getElementById('rotation-impact').textContent = getRotationImpactDescription();
            
            // Renderizar gr√°ficos de productos individuales
            renderProductPredictions();
        }

        function renderProductPredictions() {
            // Gr√°fico para producto 1
            const canvas1 = document.getElementById('product-chart-1');
            if (canvas1) {
                const ctx = canvas1.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['M1', 'M2', 'M3', 'M4', 'P1'],
                        datasets: [{
                            label: 'Marlboro Rojo',
                            data: [45, 52, 60, 48, 65],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { display: false },
                            x: { display: false }
                        }
                    }
                });
            }
            
            // Gr√°fico para producto 2
            const canvas2 = document.getElementById('product-chart-2');
            if (canvas2) {
                const ctx = canvas2.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['M1', 'M2', 'M3', 'M4', 'P1'],
                        datasets: [{
                            label: 'Loter√≠a Nacional',
                            data: [85, 90, 95, 80, 82],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { display: false },
                            x: { display: false }
                        }
                    }
                });
            }
        }

        function getRotationImpactDescription() {
            const rotation = parseFloat(state.stats.rotationRate);
            if (rotation > 2.5) return "Alto (rotaci√≥n buena)";
            if (rotation > 1.5) return "Normal";
            return "Bajo (rotaci√≥n deficiente)";
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'success') {
            // Implementaci√≥n b√°sica
            alert(`${type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'} ${message}`);
        }

        // Ejecutar simulaci√≥n cada 10 segundos (solo para demo)
        setInterval(simulateNewSale, 10000);
    </script>
</body>
</html>
